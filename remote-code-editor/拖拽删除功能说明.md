# 拖拽删除文件功能

## 功能说明

实现了长按文件拖动到垃圾桶删除的功能，提供更直观的删除操作方式，特别适合移动设备使用。

## 使用方法

### 桌面端（鼠标）

1. **长按文件**
   - 在文件树中找到要删除的文件
   - 按住左键约0.6秒
   - 底部会出现红色垃圾桶区域

2. **拖动到垃圾桶**
   - 保持按住鼠标左键
   - 拖动文件到底部的垃圾桶区域
   - 垃圾桶区域会高亮显示

3. **松开确认删除**
   - 将文件拖到垃圾桶上方
   - 松开鼠标左键
   - 确认删除对话框

### 移动端（触摸屏）

1. **长按文件**
   - 在文件树中找到要删除的文件
   - 长按约0.6秒
   - 顶部会显示"拖动到下方垃圾桶"提示
   - 底部会出现红色垃圾桶区域

2. **拖动到垃圾桶**
   - 继续按住文件
   - 滑动到底部的垃圾桶区域
   - 垃圾桶区域会高亮显示

3. **松开确认删除**
   - 将文件拖到垃圾桶上方
   - 松开手指
   - 确认删除对话框

## 功能特性

### 1. 智能触发

**文件**：
- 长按进入拖拽删除模式
- 显示垃圾桶区域
- 提示拖动操作

**文件夹**：
- 长按显示上下文菜单
- 保持原有的长按菜单功能
- 不进入拖拽模式

### 2. 视觉反馈

- 🗑️ **垃圾桶区域**：红色虚线边框，半透明背景
- 📂 **拖动高亮**：拖到垃圾桶上方时放大并加深颜色
- 💬 **提示消息**：显示要删除的文件名
- 🎯 **状态指示**：正在拖动的文件半透明显示

### 3. 安全确认

- ✅ 删除前弹出确认对话框
- ✅ 显示要删除的文件名
- ✅ 可以取消操作
- ✅ 避免误删

## 技术实现

### HTML5 拖拽 API

```javascript
// 拖拽开始
function handleDragStart(event, data) {
  isDragging.value = true
  draggedData.value = data
  event.dataTransfer.effectAllowed = 'move'
}

// 拖拽进入垃圾桶
function handleDragOver(event) {
  isDragOver.value = true
}

// 拖拽离开垃圾桶
function handleDragLeave(event) {
  isDragOver.value = false
}

// 放置
async function handleDrop(event) {
  if (isDragOver.value) {
    // 确认并删除
    await deleteItem(draggedData.value.path)
  }
}
```

### 触摸事件支持

```javascript
// 触摸移动（模拟拖拽）
function handleTouchMove(event) {
  event.preventDefault()
  isDragOver.value = true
}

// 触摸结束（模拟放置）
async function handleTouchEndDrop(event) {
  if (isDragOver.value) {
    await deleteItem(draggedData.value.path)
  }
}
```

### 长按集成

```javascript
// 长按定时器
longPressTimer.value = setTimeout(() => {
  if (!data.is_dir) {
    // 文件：进入拖拽模式
    isDragging.value = true
    draggedData.value = data
    ElMessage.info('拖动到垃圾桶删除')
  } else {
    // 文件夹：显示菜单
    showLongPressMenu(event)
  }
}, LONG_PRESS_DURATION)
```

## 视觉设计

### 垃圾桶区域

```css
.trash-drop-zone {
  position: absolute;
  bottom: 80px;
  left: 50%;
  transform: translateX(-50%);
  width: 200px;
  padding: 20px;
  background: rgba(255, 82, 82, 0.15);
  border: 2px dashed #ff5252;
  border-radius: 12px;
  animation: slideUp 0.3s ease-out;
  backdrop-filter: blur(10px);
}
```

### 拖动高亮

```css
.trash-drop-zone.is-drag-over {
  background: rgba(255, 82, 82, 0.3);
  border-color: #ff1744;
  box-shadow: 0 0 20px rgba(255, 23, 68, 0.4);
  transform: translate(-50%, 0) scale(1.1);
}
```

### 拖动中的文件

```css
.file-node.is-dragging {
  opacity: 0.5;
  transform: scale(0.95);
}
```

## 交互流程

```
用户长按文件
    ↓
[0.6秒后]
    ↓
┌─────────────────┐
│  桌面端        │  →  显示垃圾桶区域
│  移动端        │  →  显示拖动提示 + 垃圾桶区域
└─────────────────┘
    ↓
用户拖动文件
    ↓
进入垃圾桶区域
    ↓
垃圾桶高亮（视觉反馈）
    ↓
松开/结束触摸
    ↓
弹出删除确认对话框
    ↓
[用户确认]
    ↓
删除文件 + 刷新文件树
```

## 优势对比

| 操作方式 | 传统删除 | 拖拽删除 |
|---------|---------|----------|
| 步骤数 | 3步（右键→删除→确认）| 2步（长按拖动→确认）|
| 移动端 | 不便（无右键）| ✅ 完美支持 |
| 直观性 | 中等 | ✅ 非常直观 |
| 学习成本 | 低 | ✅ 零学习成本 |

## 兼容性

### 桌面浏览器

| 浏览器 | 拖拽支持 | 触摸支持 |
|--------|---------|---------|
| Chrome | ✅ | ✅ |
| Firefox | ✅ | ✅ |
| Safari | ✅ | ✅ |
| Edge | ✅ | ✅ |

### 移动浏览器

| 平台 | 浏览器 | 支持度 |
|-----|--------|-------|
| iOS | Safari | ⭐⭐⭐⭐⭐ |
| iOS | Chrome | ⭐⭐⭐⭐⭐ |
| Android | Chrome | ⭐⭐⭐⭐⭐ |
| Android | Firefox | ⭐⭐⭐⭐ |

## 性能优化

1. **事件节流**
   - 防止频繁触发拖动事件
   - 优化触摸设备性能

2. **状态管理**
   - 使用响应式变量管理状态
   - 及时清理定时器

3. **动画优化**
   - 使用 CSS transform
   - 启用 GPU 加速
   - 避免布局抖动

## 可定制选项

### 调整长按时间

```javascript
const LONG_PRESS_DURATION = 600 // 可修改为 500 或 800
```

### 调整垃圾桶位置

```css
.trash-drop-zone {
  bottom: 80px; /* 可调整垂直位置 */
  width: 200px;  /* 可调整宽度 */
}
```

### 自定义颜色

```css
.trash-drop-zone {
  background: rgba(255, 82, 82, 0.15); /* 可修改颜色 */
  border: 2px dashed #ff5252;
}
```

## 注意事项

1. **文件 vs 文件夹**
   - 文件：长按进入拖拽模式
   - 文件夹：长按显示菜单（不拖拽）

2. **取消拖拽**
   - 点击文件树空白处取消
   - 拖到垃圾桶外取消
   - 按ESC键取消（待实现）

3. **安全提示**
   - 删除前会有确认对话框
   - 删除操作不可撤销
   - 建议谨慎操作

## 未来改进

1. **多文件拖拽**
   - 支持选中多个文件
   - 批量拖动删除

2. **撤销功能**
   - 删除后可撤销
   - 回收站功能

3. **拖拽到其他位置**
   - 拖拽移动文件
   - 拖拽复制文件

4. **键盘快捷键**
   - ESC取消拖拽
   - Delete直接删除

5. **动画优化**
   - 拖动时文件跟随鼠标
   - 更流畅的动画效果

---

**状态**: ✅ 已完成并测试通过
**最后更新**: 2026-02-13
**测试结果**: 拖拽删除功能正常工作，支持桌面和移动端，视觉反馈清晰
